<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8"/>
<title>ARC / CR / NUR Editor</title>
<style>
body { font-family: Arial; margin: 20px; }
#editor { width: 600px; height: 300px; border: 1px solid #888; }
button { margin: 4px; padding: 6px 10px; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th,td { border: 1px solid #ccc; padding: 6px; vertical-align: top; }
pre { margin: 0; white-space: pre-wrap; }
.green { background: #c7f9cc; }
.orange { background: #ffe29a; }
.red { background: #ffb3b3; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
</head>
<body>

<h2>JSON Editor – ARC / CR / NUR</h2>

<div id="editor"></div>

<h3>Přednastavené alternativy</h3>

<button onclick="loadSample('ARC','A')">ARC – varianta A</button>
<button onclick="loadSample('ARC','B')">ARC – varianta B</button>

<button onclick="loadSample('CR','A')">CR – varianta A</button>
<button onclick="loadSample('CR','B')">CR – varianta B</button>

<button onclick="loadSample('NUR','A')">NUR – varianta A</button>
<button onclick="loadSample('NUR','B')">NUR – varianta B</button>

<button onclick="send()">Vyhodnotit</button>

<h3>Výsledky</h3>
<table id="respTable">
<thead>
<tr>
  <th>Modul</th>
  <th>Varianta</th>
  <th>Vstup</th>
  <th>Výstup</th>
  <th>Komentář AI</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
// ------------------------------------------------------------
// Editor
// ------------------------------------------------------------
let editor = ace.edit("editor");
editor.session.setMode("ace/mode/json");
editor.dataset.module = "ARC";
editor.dataset.version = "A";

// ------------------------------------------------------------
// Přednastavené payloady
// ------------------------------------------------------------
const presets = {
  ARC: {
    A: {
      signals:{ CN:{concentration:0.60}, RU:{entropy:0.30}, US:{profit_bias:0.40} },
      adapt_delta:{ cn:0.01, ru:-0.01, us:0.0 }
    },
    B: {
      signals:{ CN:{concentration:0.90}, RU:{entropy:0.10}, US:{profit_bias:0.20} },
      adapt_delta:{ cn:0.03, ru:-0.02, us:-0.01 }
    }
  },
  CR: {
    A: {
      signals:{ CN:{concentration:0.20}, RU:{entropy:0.80}, US:{profit_bias:0.50} },
      adapt_delta:{ cn:-0.01, ru:0.03, us:0.01 }
    },
    B: {
      signals:{ CN:{concentration:0.10}, RU:{entropy:0.95}, US:{profit_bias:0.70} },
      adapt_delta:{ cn:-0.02, ru:0.05, us:0.02 }
    }
  },
  NUR: {
    A: {
      signals:{ CN:{concentration:0.50}, RU:{entropy:0.55}, US:{profit_bias:0.45} },
      adapt_delta:{ cn:0.00, ru:0.00, us:0.00 }
    },
    B: {
      signals:{ CN:{concentration:0.70}, RU:{entropy:0.30}, US:{profit_bias:0.50} },
      adapt_delta:{ cn:0.02, ru:-0.02, us:0.01 }
    }
  }
};

// ------------------------------------------------------------
// Načtení vzorku
// ------------------------------------------------------------
function loadSample(mod, ver){
  editor.dataset.module = mod;
  editor.dataset.version = ver;
  editor.setValue(JSON.stringify(presets[mod][ver], null, 2), -1);
}

// ------------------------------------------------------------
// Výpočet simulovaných výsledků
// ------------------------------------------------------------
function simulateOutput(module, payload){
  const s = payload.signals;
  const d = payload.adapt_delta;

  if(module === "ARC"){
    let reliability = 1 - (s.RU.entropy * 0.6) + (s.CN.concentration * 0.4) - Math.abs(d.ru)*0.5;
    reliability = Math.max(0, Math.min(1, reliability));
    return {
      out:{ reliability: reliability },
      comment: reliability>0.7 ?
        "Systém je stabilní, signály jsou konzistentní." :
        "Zvýšená entropie nebo korekce snižují jistotu."
    };
  }

  if(module === "CR"){
    let chaos = s.RU.entropy*0.7 + (1-s.CN.concentration)*0.3 + Math.abs(d.ru)*0.4;
    chaos = Math.max(0, Math.min(1, chaos));
    return {
      out:{ chaos: chaos },
      comment: chaos>0.7 ?
        "Systém je velmi chaotický, vysoká entropie." :
        "Chaotičnost je mírná nebo kontrolovaná."
    };
  }

  if(module === "NUR"){
    let stability = (s.CN.concentration*0.4) + ((1-s.RU.entropy)*0.4) - Math.abs(d.cn)*0.2;
    stability = Math.max(0, Math.min(1, stability));
    return {
      out:{ stability: stability },
      comment: stability>0.7 ?
        "Osobní stabilita je vysoká, vlivy jsou pod kontrolou." :
        "Stabilita kolísá, zvaž úpravu přístupů."
    };
  }
}

// ------------------------------------------------------------
// Barvy buněk podle hodnoty
// ------------------------------------------------------------
function colorCell(mod,val){
  if(val>0.7) return "green";
  if(val>0.4) return "orange";
  return "red";
}

// ------------------------------------------------------------
// Odeslání (simulace API)
// ------------------------------------------------------------
function send(){
  let mod = editor.dataset.module;
  let ver = editor.dataset.version;

  let payload;
  try { payload = JSON.parse(editor.getValue()); }
  catch(e){ alert("Neplatný JSON."); return; }

  let res = simulateOutput(mod, payload);

  // Najdi hodnotu pro barvu
  let val = Object.values(res.out)[0];

  // Vložení do tabulky
  let tbody = document.querySelector("#respTable tbody");
  let row = tbody.insertRow(-1);

  row.insertCell(0).innerText = mod;
  row.insertCell(1).innerText = ver;
  row.insertCell(2).innerHTML = "<pre>"+JSON.stringify(payload,null,2)+"</pre>";

  let out = row.insertCell(3);
  out.innerHTML = "<pre>"+JSON.stringify(res.out,null,2)+"</pre>";
  out.className = colorCell(mod,val);

  row.insertCell(4).innerText = res.comment;
}
</script>
</body>
</html>
