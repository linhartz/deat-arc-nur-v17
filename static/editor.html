<!doctype html>
<html>
<head>
<meta charset='utf-8'/>
<title>DEAT JSON Editor + Table</title>
<style>
  body{font-family:Arial;margin:20px}
  #editor{height:200px;border:1px solid #ccc;margin-bottom:10px;}
  table{border-collapse:collapse;width:100%;margin-top:20px;}
  th, td{border:1px solid #ccc;padding:4px;text-align:left;vertical-align:top;}
  button{margin:2px;}
  pre{margin:0;}
  .green{background-color:#c6efce;}
  .yellow{background-color:#ffeb9c;}
  .red{background-color:#f4c7c3;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/ace.js"></script>
</head>
<body>
<h3>DEAT JSON Editor + Response Table</h3>
<select id="endpoint">
  <option value="/arc">ARC</option>
  <option value="/cr">CR</option>
  <option value="/nur">NUR</option>
</select>
<button onclick="send()">Send (Simulate)</button>

<h4>Load Sample Payloads</h4>
<!-- ARC buttons -->
<button onclick="loadARCv1()">ARC v1</button>
<button onclick="loadARCv2()">ARC v2</button>
<!-- CR buttons -->
<button onclick="loadCRv1()">CR v1</button>
<button onclick="loadCRv2()">CR v2</button>
<!-- NUR buttons -->
<button onclick="loadNURv1()">NUR v1</button>
<button onclick="loadNURv2()">NUR v2</button>

<div id="editor">{} </div>

<h4>Response Table</h4>
<table id="respTable">
<tr>
  <th>Module</th>
  <th>Version</th>
  <th>Input</th>
  <th>Output</th>
  <th>AI Comment</th>
</tr>
</table>

<script>
var editor = ace.edit('editor');
editor.session.setMode('ace/mode/json');
editor.setValue('{}', -1);

let table = document.getElementById('respTable');

// --- Sample payloads ---
const samples = {
  ARC: [
    {v:"v1", payload:{signals:{CN:{concentration:0.9},RU:{entropy:0.1},US:{profit_bias:0.5}}, adapt_delta:{cn:0.01,ru:-0.01,us:0}}},
    {v:"v2", payload:{signals:{CN:{concentration:0.5},RU:{entropy:0.7},US:{profit_bias:0.2}}, adapt_delta:{cn:0,ru:0.02,us:-0.01}}}
  ],
  CR: [
    {v:"v1", payload:{provocations:[{intensity:0.2, source_type:"individual", vector:"social", confidence:0.8},{intensity:0.3, source_type:"individual", vector:"financial", confidence:0.9}]}},
    {v:"v2", payload:{provocations:[{intensity:0.6, source_type:"state", vector:"media", confidence:0.7},{intensity:0.8, source_type:"agency", vector:"politics", confidence:0.5},{intensity:0.5, source_type:"individual", vector:"finance", confidence:0.4}]}}
  ],
  NUR: [
    {v:"v1", payload:{assets:{real_estate:50000,savings:20000,stocks:10000}, passive_income:2000, active_input:500}},
    {v:"v2", payload:{assets:{real_estate:20000,savings:5000,stocks:2000}, passive_income:500, active_input:2000}}
  ]
};

// --- Load functions ---
function loadSample(mod, idx){
  editor.setValue(JSON.stringify(samples[mod][idx].payload, null,2), -1);
  editor.dataset.module = mod;
  editor.dataset.version = samples[mod][idx].v;
}

function loadARCv1(){loadSample("ARC",0);}
function loadARCv2(){loadSample("ARC",1);}
function loadCRv1(){loadSample("CR",0);}
function loadCRv2(){loadSample("CR",1);}
function loadNURv1(){loadSample("NUR",0);}
function loadNURv2(){loadSample("NUR",1);}

// --- Simulate outputs with colors ---
function simulateOutput(module, payload){
  let out={}, comment="";
  if(module==="ARC"){
    let s=payload.signals;
    out.reliability=1-(0.33*s.CN.concentration +0.33*s.RU.entropy +0.33*s.US.profit_bias);
    comment="Nižší hodnota = vyšší vliv RU; CN silně ovlivňuje stabilitu.";
  }
  else if(module==="CR"){
    let prov=payload.provocations||[];
    let total=prov.reduce((acc,p)=>acc+(p.intensity||0),0);
    let avgConf=prov.reduce((acc,p)=>acc+(p.confidence||0),0)/Math.max(prov.length,1);
    out.chaos=Math.min(1,total/3);
    comment="Vyšší chaos a nízká průměrná důvěra zvyšují CR riziko.";
  }
  else if(module==="NUR"){
    let assetsSum=Object.values(payload.assets||{}).reduce((a,b)=>a+b,0);
    out.stability=assetsSum*0.4 + (payload.passive_income||0)*0.4 + (payload.active_input||0)*0.2;
    comment="Nižší aktiva nebo pasivní příjem vyžadují zvýšení aktivního vstupu.";
  }
  return {out, comment};
}

function colorCell(module, value){
  if(module==="ARC"){
    if(value>0.7) return "green";
    if(value>0.4) return "yellow";
    return "red";
  }
  if(module==="CR"){
    if(value<0.3) return "green";
    if(value<0.7) return "yellow";
    return "red";
  }
  if(module==="NUR"){
    if(value>50000) return "green";
    if(value>20000) return "yellow";
    return "red";
  }
  return "";
}

// --- Send (simulate) ---
function send(){
  let mod=editor.dataset.module||"ARC";
  let payload=JSON.parse(editor.getValue());
  let result=simulateOutput(mod,payload);

  let row=table.insertRow(-1);
  row.insertCell(0).innerText=mod;
  row.insertCell(1).innerText=editor.dataset.version||"vX";
  row.insertCell(2).innerHTML="<pre>"+JSON.stringify(payload,null,2)+"</pre>";

  // Output with color
  let outCell=row.insertCell(3);
  let val="";
  if(mod==="ARC") val=result.out.reliability;
  else if(mod==="CR") val=result.out.chaos;
  else if(mod==="NUR") val=result.out.stability;
  outCell.innerHTML="<pre>"+JSON.stringify(result.out,null,2)+"</pre>";
  outCell.className=colorCell(mod,val);

  row.insertCell(4).innerText=result.comment;
}
</script>
</body>
</html>
